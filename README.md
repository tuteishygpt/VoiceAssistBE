# Мінімальны галасавы асістэнт

Гэты рэпазіторый змяшчае FastAPI-сервер (`server.py`), які працуе ў пары з вэб-кліентам (`index.html`). Сервер стрымінгава перадае аўдыя з XTTS (генератар `text_to_speech` з `app.py`) і проксіруе запыты ў Gemini (ASR + LLM).

## Патрабаванні
- Python 3.10+
- GPU (жадана) для XTTS, але генератар з `app.py` можа працаваць і на CPU
- Node не патрэбны: кліент — статычны HTML, які аддае FastAPI

### Python-залежнасці
Усталюйце іх праз `pip` (рэкамендавана віртуальнае асяроддзе) з дапамогай `requirements.txt`:

```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

`app.py` пры імпарце сам усталёўвае/загружае ўсе патрэбныя мадэльныя залежнасці XTTS (клануе мадэль, качае вагі, рыхтуе кэшы). Ніякіх дадатковых крокаў для TTS не патрабуецца.

## Асяроддзе
Перад стартам трэба выставіць ключы Gemini:

```bash
export GEMINI_API_KEY="<твой-ключ>"
export GEMINI_MODEL="gemini-1.5-flash"  # неабавязкова, ёсць значэнне па змаўчанні
```

## Запуск сервера
Выкарыстай `uvicorn` (або іншы ASGI-сервер):

```bash
uvicorn server:app --host 0.0.0.0 --port 8000 --reload
```

Пасля запуску адкрывай у браўзеры `http://localhost:8000` — загрузіцца `index.html`.

## Працэс працы
1. Націск “Hold to talk” у браўзеры запускае MediaRecorder і адпраўляе запісаны WebM у `POST /api/asr`.
2. FastAPI дасылае аўдыя ў Gemini ASR і вяртае транскрыпцыю.
3. `POST /api/llm` запытвае Gemini LLM і вяртае адказ.
4. Кліент адкрывае `WS /ws/tts`, перадае тэкст + налады буфераў. Сервер запускае `text_to_speech(...)` і стриміць base64 Float32 PCM.
5. Javascript-аўдыяпрайгравальнік (перанесены з `app.py`) дэкадуе чанкі, апрацоўвае barge-in і паказвае метрыкі.

## Тэставанне
Для хуткай праверкі сінтаксісу Python:

```bash
python -m py_compile server.py
```

У браўзеры маніторзь лаг-панэль, каб бачыць латэнты XTTS і час адгуку.

## Запуск у Google Colab
Калі трэба падняць асістэнт у воблаку, адкрывай `colab_setup.ipynb` непасрэдна ў Google Colab:

1. Выканаў першыя дзве каміркі, каб усталяваць залежнасці і скланаваць рэпазіторый (пры жаданні замяні URL на свой форк).
2. У камірцы «Ключы і параметры» ўстаў свой `GEMINI_API_KEY` (і `NGROK_AUTH_TOKEN`, калі патрэбен пастаянны тунэль).
3. Пасля запуску каміркі з Ngrok скапіруй публічны URL — праз яго адкрываўся `index.html`.
4. Запусці апошнюю камірку з `uvicorn.run(...)` і не спыняй яе, пакуль карыстаешся вэб-кліентам.

Нотбук наўпрост выкарыстоўвае `server.py` і `index.html`, таму функцыі push-to-talk і barge-in працуюць гэтак жа, як пры лакальным запуску.
